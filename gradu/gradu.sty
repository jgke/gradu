\ProvidesPackage{gradu}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{amsfonts,amsmath,amssymb,amsthm,booktabs,color,enumitem,graphicx}
\usepackage[pdftex,hidelinks]{hyperref}
\usepackage{bookmark}
\usepackage{appendix}
\usepackage[natbibapa,sectionbib]{apacite}
\usepackage[finnish]{babel}
\usepackage{hyperref}
\usepackage{multirow}
\usepackage{tikz}
\usepackage{placeins}
\usepackage{import}
\usepackage{etoolbox}
\usepackage{refcount}
\usepackage{tocloft}
\usepackage[nottoc]{tocbibind}
\usepackage{xassoccnt}

%\usepackage[top=2em]{geometry}
%\usepackage{showframe}

\bibliographystyle{apacite}

\newcommand{\citationneeded}{\textbf{[citation\_needed]}}

\makeatletter
\@ifundefined{@auxappendixtotalcount}{\gdef{\auxappendixtotalcount}{0}{}}
\newcommand{\totalpagecount}{\pageref{mylastpage}}
\newcommand{\totalappendixcount}{%
    \@ifundefined{r@appendixbegin}{0}{%
        \ifcsname @auxappendixtotalcount \endcsname
            \csname @auxappendixtotalcount \endcsname
        \else
            ??%
        \fi
    }%
}
\numberofpagesinformation{%
    \@ifundefined{r@appendixbegin}{%
    \totalpagecount\ sivua%
    }{%
    \totalpagecount\ sivua + \totalappendixcount\ liitesivua%
    }%
}

\makeatother


\newcounter{appendixCount}
\newcounter{appendixPageCount}

\NewTotalDocumentCounter{totalrealpage}
\NewDocumentCounter{realpage}

\DeclareAssociatedCounters{page}{realpage,totalrealpage}
\makeatletter
\AtBeginDocument{%
      \setcounter{realpage}{1}
      }

      \makeatother

\newcommand{\appendixsection}[1]{
    \newpage
    \pagenumbering{arabic}
    \phantomsection
    \stepcounter{appendixCount}
    \section*{Liite \arabic{appendixCount}. #1}
    \cftaddtitleline{toc}{section}{\arabic{appendixCount} #1}{}
}


\DeclareAssociatedCounters{page}{appendixPageCount}
\makeatletter
\AtBeginDocument{%
\stepcounter{appendixPageCount}
}

\newcommand{\appendixbeginhere}{
    \label{mylastpage}
    \newpage
    \label{appendixbegin}
    \cftaddtitleline{toc}{section}{Liitteet}{}
    \pagenumbering{gobble}
    \appendix
    \renewcommand{\thesection}{{\arabic{section}}}
}

\newcommand{\tocbeginshere}{\label{tocbegin}}
\newcommand{\appendixendhere}{%
    \label{appendixend}%
    \write\@auxout{%
        \unexpanded{\global\@namedef{usevalue@#1}{#2}}%
    }%
}

\newcommand{\hilight}[1]{\colorbox{yellow}{#1}}
